# -*- mode: org; -*-

#+begin_src emacs-lisp :results none :export none
  (org-babel-tangle-file "README")
#+end_src

Le dossier contient les données du séquençage des deux plaques envoyées à la
suite des manips de Anne-Laure. 

* structure
#+BEGIN_SRC sh :results verbatim 
tree ./ -L 2
#+END_SRC

#+RESULTS:
#+begin_example
./
|-- README
|-- analysis
|-- data
|   |-- 1369607.INDEL.csv
|   |-- 1369607.SNP.csv
|   |-- 1369628.INDEL.csv
|   |-- 1369628.SNP.csv
|   |-- Analysis_Summary-Sanger_Pipeline.pdf
|   |-- fasta
|   |-- raw_seq_nvbr
|   |-- seq
|   `-- spectrograms
`-- scripts
    |-- exploratory_analysis.R
    `-- extract_raw_data.sh

7 directories, 8 files
#+end_example
* data
** raw_seq_nvbr
Contient les deux dataset au format .zip. DO NOT TOUCH.
** extraction des données
Pour extraire les données du fichier brut .zip à la structure de données.

#+BEGIN_SRC sh :tangle ./scripts/extract_raw_data.sh 
  #!/bin/bash 

  # Le script qui extrait les données depuis les fichiers zip bruts et qui met en
  # place la structure de fichier.

  cd ./data # cd ../data quand dans dossier `scripts'
  # extraction des données brutes
  unzip raw_seq_nvbr/1369607.zip
  unzip raw_seq_nvbr/1369628.zip
  # déplace tout les fichiers dans des dossiers adaptés 
  find . -name "*.fas" -exec mv -i {} -t ./fasta/ \;
  find . -name "*.ab1" -exec mv -i {} -t ./spectrograms/ \;
  find . -name "*.seq" -exec mv -i {} -t ./seq/ \;
  # déplace le contenu du dossier inutile dans le présent dossier
  mv 1369628/* ./
  rm -r 1369628 # supprime le dossier
#+END_SRC

* analysis 
Contient les résultats des analyses. Graphes ou données transformées. 
* scripts 
Contient les différents scripts nécessaires pour aboutir aux contenus
d'~analysis~. 

** .csv analyses
#+BEGIN_SRC R :tangle ./scripts/exploratory_analysis.R 
  library(dplyr)
  library(ggplot2)
  library(readr)

  read_result <- function(filename){
    readr::read_delim(filename, delim = ";")
  }

  snp_strong   <- read_result("./data/1369628.SNP.csv")
  snp_weak   <- read_result("./data/1369607.SNP.csv")
  indel_strong <- read_result("./data/1369628.INDEL.csv")
  indel_weak <- read_result("./data/1369607.INDEL.csv")
  snp_weak$mutant <- "weak"
  snp_strong$mutant <- "strong"
#+END_SRC

** ab1 python parser

C'est un script python qui convertit les fichiers .ab1 du dossier
[[./data/spectrograms/]]  en fichier .fastq, dans le dossier [[./data/fastq/]].  
Trois choses :
- lire le fichier en entrée
- transformer en fastq
- écrire sur le disque. 

#+BEGIN_SRC python :tangle ./scripts/ab1_parser.py
  #!/usr/bin/env python
  import os
  from Bio import SeqIO

  # lit tout les fichiers du dossier spectrogram
  for file_name in os.listdir("../data/spectrograms/"):
      # check if it ends with .ab1
      if file_name.endswith(".ab1"):
          print("parsing sequences from " + file_name)
          
          ab1_in = "../data/spectrograms/" + file_name
          fastq_out = "../data/fastq/" + file_name[0:-4] + ".fastq"
          # convert the file
          SeqIO.convert(ab1_in, "abi", fastq_out, "fastq")
#+END_SRC
